# 倾斜表

存在倾斜情况的表，可以通过创建倾斜表优化性能。

```sql
CREATE TABLE skewed_single (key STRING, value STRING)
SKEWED BY (key) ON ('1','5','6')
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';

--向表中插入数据
insert OVERWRITE table skewed_single values('1','1'),('2','2'),('3','3'),('4','4'),('5','5'),('6','6'),('1','1'),('5','5'),('6','6'),('1','1'),('5','5'),('6','6'),('1','1'),('5','5'),('6','6'),('1','1'),('5','5'),('6','6');

0: jdbc:hive2://zgg-server:10000> desc formatted skewed_single;
+-------------------------------+----------------------------------------------------+----------------------------------------------------+
|           col_name            |                     data_type                      |                      comment                       |
+-------------------------------+----------------------------------------------------+----------------------------------------------------+                                               |
| Skewed Columns:               | [key]                                              | NULL                                               |
| Skewed Values:                | [[1], [5], [6]]                                    | NULL                                               |
+-------------------------------+----------------------------------------------------+----------------------------------------------------+
```

```sql
CREATE TABLE skewed_multiple (key STRING, value STRING)
SKEWED BY (key, value) ON (('1','One'), ('3','Three'), ('5','Five'))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';

--插入数据
insert OVERWRITE table skewed_multiple values('1','One'),('2','One'),('3','One'),('4','One'),('5','One'),('6','One'),('1','Two'),('5','Two'),('6','Two'),('1','Three'),('2','Three'),('3','Three'),('4','Three'),('5','Three'),('6','Three'),('1','Four'),('5','Four'),('6','Four'),('5','Five'),('6','Four');


0: jdbc:hive2://zgg-server:10000> desc formatted skewed_multiple;
+-------------------------------+----------------------------------------------------+----------------------------------------------------+
|           col_name            |                     data_type                      |                      comment                       |
+-------------------------------+----------------------------------------------------+----------------------------------------------------+
| Skewed Columns:               | [key, value]                                       | NULL                                               |
| Skewed Values:                | [[1, one], [3, three], [5, five]]                  | NULL    
```

优化原理 [点这里](https://github.com/ZGG2016/hive/blob/master/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E8%AF%91%E6%96%87/Resources%20for%20Contributors/Hive%20Design%20Docs/Optimizing%20Skewed%20Joins.md) 查看

----------------------------------------

sql语句来自: [https://cloud.tencent.com/developer/article/1875943](https://cloud.tencent.com/developer/article/1875943)
