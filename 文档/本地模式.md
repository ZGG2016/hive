# 本地模式

TODO

作用：

可以在用户的本地工作站运行 map-reduce jobs

这对于在小数据集上运行查询非常有用，在这种情况下，本地模式执行通常比在大型集群快得多。

hive4.0

## 使用

从版本 0.7 开始，Hive 完全支持本地模式执行。用户需要启用下面的选项：

	hive> SET mapreduce.framework.name=local;

另外，`mapred.local.dir` 应指向本地机器的一个有效路径(如`/tmp/<username>/mapred/local`)。否则，用户将得到一个分配本地磁盘空间的异常。

```
`mapreduce.framework.name`	
	
Default Value: local	

The runtime framework for executing MapReduce jobs. Can be one of `local`, `classic` or `yarn`.
```

```
`mapred.local.dir`已被弃用，使用如下选项：

`mapreduce.cluster.local.dir`	

Default Value: ${hadoop.tmp.dir}/mapred/local	

The local directory where MapReduce stores intermediate data files. May be a comma-separated list of directories on different devices in order to spread disk i/o. Directories that do not exist are ignored.
```

如果启用`hive.exec.mode.local.auto=true`了，且满足下面的阈值，Hive 会分析每个查询中每个 map-reduce job 的大小，然后本地运行它：

- job 的总输入大小小于`hive.exec.mode.local.auto.inputbytes.max` (默认128MB)

- map-tasks 的总数量小于`hive.exec.mode.local.auto.tasks.max`(默认4)

- reduce-tasks 的总数量等于1或0

```sql
0: jdbc:hive2://localhost:10000> set hive.exec.mode.local.auto=true;

0: jdbc:hive2://localhost:10000> set hive.exec.mode.local.auto.inputbytes.max=134217728;

0: jdbc:hive2://localhost:10000> set hive.exec.mode.local.auto.tasks.max=4;
Error: Error while processing statement: hive configuration hive.exec.mode.local.auto.tasks.max does not exists. (state=42000,code=1)

0: jdbc:hive2://localhost:10000> select id, sum(salary) from t1 group by id;
+-----+----------+
| id  |   _c1    |
+-----+----------+
| 1   | 3000.0   |
| 2   | 8000.0   |
| 3   | 10000.0  |
| 4   | 14000.0  |
+-----+----------+
```

本地模式执行是在一个单独的子 jvm (Hive 客户端的)中执行的。

如果用户愿意，这个子 jvm 的最大内存量可以通过 `hive.mapred.local.mem` 来控制。默认情况下为0，在这种情况下，Hive 让 Hadoop 决定子 jvm 的默认内存限制。

## 参数

- hive.exec.mode.local.auto

	Default Value: false

	Lets Hive determine whether to run in local mode automatically.  

	自动决定是否启用本地模式

- hive.exec.mode.local.auto.inputbytes.max

	Default Value: 134217728

	When hive.exec.mode.local.auto is true, input bytes should be less than this for local mode.

	设置 local mr 的最大输入数据量，当输入数据量小于这个值时采用 local mr 的方式

- hive.exec.mode.local.auto.input.files.max

	Default Value: 4

	When hive.exec.mode.local.auto is true, the number of tasks should be less than this for local mode.

	设置 local mr 的最大输入文件个数，当输入文件个数小于这个值时采用 local mr 的方式


[官网 Hive,Map-ReduceandLocal-Mode](https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-Hive,Map-ReduceandLocal-Mode)